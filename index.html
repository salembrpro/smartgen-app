<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SmartGen Fussball Akademie ‚Äì App Prototype</title>
  <meta name="theme-color" content="#070a10" />

  <style>
    :root{
      /* Base */
      --bg:#070a10;
      --panel:rgba(12,18,32,.78);
      --panel2:rgba(10,15,26,.72);
      --text:#eaf2ff;
      --muted:#95a7c7;
      --line:rgba(255,255,255,.10);

      /* Status */
      --ok:#25d07f;
      --warn:#ffb020;
      --danger:#ff4d4d;

      /* Accent */
      --accent:#ff7a18;
      --accent2:#ffb14a;

      --radius:18px;
      --shadow: 0 24px 70px rgba(0,0,0,.60);
      --shadow2: 0 12px 30px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background: var(--bg);
      overflow-x:hidden;
    }

    /* ===== Carbon Background ===== */
    body::before{
      content:"";
      position:fixed; inset:0;
      background:
        /* Carbon weave */
        repeating-linear-gradient(45deg,
          rgba(255,255,255,.045) 0 10px,
          rgba(0,0,0,.10) 10px 20px
        ),
        repeating-linear-gradient(-45deg,
          rgba(255,255,255,.035) 0 10px,
          rgba(0,0,0,.12) 10px 20px
        ),
        radial-gradient(1200px 520px at 12% -10%, rgba(255,122,24,.16), transparent 55%),
        radial-gradient(900px 520px at 100% 10%, rgba(255,177,74,.10), transparent 60%),
        radial-gradient(900px 520px at 50% 120%, rgba(255,255,255,.05), transparent 65%),
        linear-gradient(180deg, #070a10 0%, #05070c 100%);
      opacity:1;
      z-index:-2;
    }
    body::after{
      content:"";
      position:fixed; inset:0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,255,255,.05), transparent 35%),
        radial-gradient(circle at 80% 30%, rgba(255,255,255,.04), transparent 40%);
      mix-blend-mode: overlay;
      opacity:.65;
      z-index:-1;
      pointer-events:none;
    }

    /* ===== Layout ===== */
    .wrap{max-width:1120px; margin:0 auto; padding:22px 16px 70px;}
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; margin-bottom:14px;
    }
    .brand{display:flex; align-items:center; gap:12px;}
    .logoDot{
      width:42px; height:42px; border-radius:16px;
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,.18), transparent 55%),
        linear-gradient(135deg, rgba(255,122,24,1), rgba(255,177,74,.55));
      box-shadow: 0 0 0 1px rgba(255,255,255,.12), 0 18px 50px rgba(255,122,24,.18);
    }
    .brand h1{font-size:18px; margin:0; letter-spacing:.3px}
    .brand p{margin:0; color:var(--muted); font-size:13px}

    .pill{
      display:inline-flex; align-items:center; gap:10px;
      border:1px solid var(--line);
      padding:10px 12px; border-radius:999px;
      background: rgba(12,18,32,.55);
      box-shadow: 0 8px 28px rgba(0,0,0,.25);
      font-size:13px; color:var(--muted);
      user-select:none;
      white-space:nowrap;
    }
    .pill b{color:var(--text); font-weight:800}
    .dot{
      width:10px;height:10px;border-radius:50%;
      background:var(--ok);
      box-shadow: 0 0 0 5px rgba(37,208,127,.10);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
    }
    @media (max-width: 950px){
      .grid{grid-template-columns:1fr}
      .pill{display:none}
    }

    .card{
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* ===== ID Header ===== */
    .idHeader{
      position:relative;
      padding:18px;
      background:
        radial-gradient(700px 240px at 10% 0%, rgba(255,122,24,.20), transparent 60%),
        radial-gradient(700px 240px at 90% 20%, rgba(255,177,74,.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));
      border-bottom:1px solid var(--line);
    }
    .idRow{
      display:flex; gap:14px; align-items:flex-start;
    }

    /* Avatar replaced with BIG football icon */
    .avatar{
      width:86px;height:86px;border-radius:22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      box-shadow: 0 14px 40px rgba(0,0,0,.45);
      flex:0 0 auto;
      display:grid; place-items:center;
      position:relative;
      overflow:hidden;
    }
    .avatar::before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.10), transparent 55%),
        linear-gradient(135deg, rgba(255,122,24,.22), rgba(255,177,74,.08));
      opacity:1;
    }
    .avatar .ball{
      position:relative;
      width:54px; height:54px;
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.55));
    }
    .idInfo{flex:1}
    .nameLine{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:8px;
    }
    .name{
      font-size:20px; margin:0;
      letter-spacing:.3px;
      font-weight:900;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 12px; border-radius:999px;
      border:1px solid rgba(255,122,24,.28);
      background: rgba(255,122,24,.10);
      color:#ffe3c5; font-size:13px;
      box-shadow: 0 10px 30px rgba(255,122,24,.10);
      white-space:nowrap;
      font-weight:800;
    }

    .muted{color:var(--muted); font-size:13px; line-height:1.35}
    .miniChip{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:12px;
    }
    .chip{
      padding:9px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(12,18,32,.55);
      color:var(--muted);
      font-size:13px;
      font-weight:700;
    }
    .chip b{color:var(--text); font-weight:900}

    /* BIGGER buttons for kids */
    .idControls{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:14px;
    }
    .btn{
      border:1px solid var(--line);
      background: rgba(12,18,32,.70);
      color: var(--text);
      padding:12px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      font-size:14px;
      letter-spacing:.2px;
      transition: transform .10s ease, border-color .10s ease, background .10s ease;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(255,122,24,.38)}
    .btn.primary{
      border-color: rgba(255,122,24,.45);
      background: linear-gradient(135deg, rgba(255,122,24,.25), rgba(255,177,74,.10));
      box-shadow: 0 16px 40px rgba(255,122,24,.12);
    }

    .section{padding:16px 18px;}
    .section h2{
      margin:0 0 10px 0;
      font-size:16px;
      letter-spacing:.2px;
      color:#eaf2ff;
      font-weight:900;
    }

    /* ===== Simple rows with BIG icons ===== */
    .list{display:flex; flex-direction:column; gap:10px;}
    .row{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(12,18,32,.45);
    }
    .row .left{display:flex; gap:12px; align-items:center}
    .icon{
      width:46px;height:46px;border-radius:16px;
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color:#ffe3c5;
      font-size:22px;
    }
    .rowTitle{margin:0; font-weight:900; font-size:15px}
    .rowSub{margin:2px 0 0; color:var(--muted); font-size:13px; font-weight:700}
    .tag{
      font-size:12px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      white-space:nowrap;
      font-weight:900;
    }
    .tag.ok{border-color: rgba(37,208,127,.35); color:#bff4de; background: rgba(37,208,127,.10)}
    .tag.warn{border-color: rgba(255,176,32,.35); color:#ffe2b8; background: rgba(255,176,32,.10)}
    .tag.danger{border-color: rgba(255,77,77,.35); color:#ffd0d0; background: rgba(255,77,77,.10)}

    /* ===== Slots ===== */
    .slotsGrid{display:grid; grid-template-columns:1fr; gap:10px;}
    .slot{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px;
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(12,18,32,.45);
    }
    .slot strong{font-size:15px; font-weight:900}
    .slot small{display:block; color:var(--muted); margin-top:2px; font-size:13px; font-weight:700}
    .slot .right{display:flex; align-items:center; gap:10px}

    .slotBtn{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,122,24,.40);
      background: rgba(255,122,24,.12);
      color:#ffe3c5;
      cursor:pointer;
      font-weight:900;
      font-size:14px;
    }
    .slotBtn:disabled{
      opacity:.45;
      cursor:not-allowed;
      border-color: rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--muted);
    }

    /* ===== Stats Card (Kid-friendly + Pro) ===== */
    .stats{
      border:1px solid var(--line);
      border-radius:18px;
      background: rgba(0,0,0,.14);
      padding:14px;
      box-shadow: var(--shadow2);
      margin-bottom:12px;
    }
    .statsTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:12px;
    }
    .statsTop h3{
      margin:0;
      font-size:16px;
      font-weight:900;
      letter-spacing:.2px;
    }

    .kpiGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-bottom:12px;
    }
    @media (max-width: 520px){
      .kpiGrid{grid-template-columns: 1fr}
    }
    .kpi{
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(12,18,32,.45);
      padding:12px;
    }
    .kpiLabel{color:var(--muted); font-size:12px; font-weight:900; letter-spacing:.2px}
    .kpiValue{font-size:22px; font-weight:1000; margin-top:4px}
    .kpiSub{color:var(--muted); font-size:12px; font-weight:800; margin-top:2px}

    .progressRow{
      display:flex; gap:12px; align-items:center;
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(12,18,32,.45);
      padding:12px;
      margin-bottom:12px;
    }
    .ring{
      width:72px; height:72px; border-radius:50%;
      display:grid; place-items:center;
      background:
        conic-gradient(var(--accent) 0deg, rgba(255,255,255,.10) 0deg);
      position:relative;
      box-shadow: 0 18px 40px rgba(0,0,0,.45);
      flex:0 0 auto;
    }
    .ring::after{
      content:"";
      position:absolute; inset:8px;
      border-radius:50%;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.10);
    }
    .ring b{
      position:relative;
      font-size:16px;
      font-weight:1000;
      letter-spacing:.2px;
    }
    .progressText{
      flex:1;
      min-width:0;
    }
    .progressText .big{
      font-size:15px;
      font-weight:1000;
      margin:0;
    }
    .progressText .small{
      margin:2px 0 0;
      color:var(--muted);
      font-size:13px;
      font-weight:800;
    }

    .chartWrap{
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(12,18,32,.45);
      padding:12px;
      margin-bottom:12px;
    }
    canvas{width:100%; height:160px; display:block}

    .actionsRow{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .btnBig{
      padding:12px 14px;
      border-radius:14px;
      font-weight:1000;
      font-size:14px;
      border:1px solid var(--line);
      background: rgba(12,18,32,.70);
      color:var(--text);
      cursor:pointer;
    }
    .btnBig.primary{
      border-color: rgba(37,208,127,.35);
      background: rgba(37,208,127,.12);
    }
    .btnBig.warn{
      border-color: rgba(255,176,32,.35);
      background: rgba(255,176,32,.10);
      color:#ffe2b8;
    }
    .btnBig.ghost{
      border-color: rgba(255,255,255,.14);
      background: rgba(0,0,0,.10);
      color:var(--muted);
    }

    /* ===== Modal ===== */
    .modalWrap{
      position:fixed; inset:0;
      background: rgba(0,0,0,.60);
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
      z-index:99;
    }
    .modal{
      width:min(560px, 100%);
      border-radius:18px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(12,18,32,.95), rgba(10,15,26,.92));
      box-shadow: 0 30px 90px rgba(0,0,0,.65);
      overflow:hidden;
    }
    .modalHead{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .modalHead b{letter-spacing:.2px; font-weight:1000}
    .x{
      width:42px;height:42px;border-radius:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.15);
      color:var(--text);
      cursor:pointer;
      font-size:16px;
      font-weight:1000;
    }
    .modalBody{padding:16px}
    .field{display:flex; flex-direction:column; gap:6px; margin-top:10px}
    .field label{font-size:12px; color:var(--muted); font-weight:900}
    input, select{
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.14);
      color: var(--text);
      padding:12px 12px;
      border-radius:14px;
      outline:none;
      font-size:14px;
      font-weight:800;
    }
    .modalActions{
      display:flex; gap:10px; justify-content:flex-end;
      padding:14px 16px;
      border-top:1px solid var(--line);
    }

    .toast{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(12,18,32,.92);
      border: 1px solid var(--line);
      padding: 12px 14px;
      border-radius: 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,.60);
      display:none;
      z-index:120;
      font-size:13px;
      color: var(--muted);
      max-width: 92vw;
    }
    .toast b{color:var(--text)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logoDot"></div>
        <div>
          <h1>SmartGen Fussball Akademie</h1>
          <p>Profil ‚Ä¢ Slots ‚Ä¢ Statistik (Demo)</p>
        </div>
      </div>

      <div class="pill" title="Live-Status">
        <span class="dot" id="statusDot"></span>
        Status: <b id="statusLabel">Aktiv</b>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <div class="idHeader">
          <div class="idRow">
            <div class="avatar" title="Fu√üball">
              <!-- Inline SVG football -->
              <svg class="ball" viewBox="0 0 64 64" aria-hidden="true">
                <defs>
                  <linearGradient id="g1" x1="0" x2="1">
                    <stop offset="0" stop-color="rgba(255,255,255,.95)"/>
                    <stop offset="1" stop-color="rgba(255,255,255,.75)"/>
                  </linearGradient>
                </defs>
                <circle cx="32" cy="32" r="26" fill="url(#g1)" opacity="0.95"/>
                <circle cx="32" cy="32" r="26" fill="none" stroke="rgba(0,0,0,.35)" stroke-width="2"/>
                <polygon points="32,18 25,23 27,31 37,31 39,23" fill="rgba(0,0,0,.55)"/>
                <path d="M25 23 L18 26 L19 35 L27 31" fill="rgba(0,0,0,.35)"/>
                <path d="M39 23 L46 26 L45 35 L37 31" fill="rgba(0,0,0,.35)"/>
                <path d="M27 31 L22 40 L28 47 L32 43 L36 47 L42 40 L37 31"
                      fill="rgba(0,0,0,.25)"/>
              </svg>
            </div>

            <div class="idInfo">
              <div class="nameLine">
                <h2 class="name">Mitglied: <span id="memberName">Amine B.</span></h2>
                <span class="badge">SmartGen ‚Ä¢ ID</span>
              </div>

              <div class="muted">
                <span id="memberMeta">U15 ‚Ä¢ Technik & Kognition</span> ‚Ä¢
                Trainer: <b id="trainerName">Salem</b>
              </div>

              <div class="miniChip">
                <div class="chip"><b>Level:</b> <span id="sportLevel">Fortgeschritten</span></div>
                <div class="chip"><b>Abo:</b> <span id="subStatus">Aktiv</span></div>
                <div class="chip"><b>N√§chster Termin:</b> <span id="nextSession">Mi 18:00</span></div>
              </div>

              <div class="idControls">
                <button class="btn primary" id="btnBook">Slot buchen</button>
                <button class="btn" id="btnStatus">Status wechseln</button>
                <button class="btn" id="btnSwapTrainer">Trainer wechseln</button>
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>Heute</h2>

          <!-- Stats -->
          <div class="stats" id="statsCard">
            <div class="statsTop">
              <h3>Statistik & Fortschritt</h3>
              <span class="chip" id="attendanceChip">Anwesenheit: --%</span>
            </div>

            <div class="kpiGrid">
              <div class="kpi">
                <div class="kpiLabel">Trainings</div>
                <div class="kpiValue" id="kpiSessions">0</div>
                <div class="kpiSub">letzte Eintr√§ge</div>
              </div>
              <div class="kpi">
                <div class="kpiLabel">Serie</div>
                <div class="kpiValue" id="kpiStreak">0</div>
                <div class="kpiSub">in Folge anwesend</div>
              </div>
              <div class="kpi">
                <div class="kpiLabel">Score</div>
                <div class="kpiValue" id="kpiPerf">--</div>
                <div class="kpiSub">0‚Äì100 (Demo)</div>
              </div>
            </div>

            <div class="progressRow">
              <div class="ring" id="ring"><b id="ringVal">0%</b></div>
              <div class="progressText">
                <p class="big">Progress Level</p>
                <p class="small" id="progressHint">Je mehr Training, desto h√∂her.</p>
              </div>
            </div>

            <div class="chartWrap">
              <div class="muted" style="margin-bottom:8px;">Letzte 10 Trainings (Anwesend + Score)</div>
              <canvas id="miniChart" width="900" height="200"></canvas>
            </div>

            <div class="actionsRow">
              <button class="btnBig primary" id="btnPresent" type="button">Heute da ‚úÖ</button>
              <button class="btnBig warn" id="btnAbsent" type="button">Heute gefehlt ‚ùå</button>
              <button class="btnBig ghost" id="btnResetStats" type="button">Reset</button>
            </div>
          </div>

          <!-- Simple focus list -->
          <div class="list">
            <div class="row">
              <div class="left">
                <div class="icon">‚öΩÔ∏è</div>
                <div>
                  <p class="rowTitle">Technik</p>
                  <p class="rowSub">Erster Kontakt ‚Ä¢ Ballannahme ‚Ä¢ Tempo</p>
                </div>
              </div>
              <span class="tag ok">Start</span>
            </div>

            <div class="row">
              <div class="left">
                <div class="icon">üß†</div>
                <div>
                  <p class="rowTitle">Kognition</p>
                  <p class="rowSub">Reaktion ‚Ä¢ Entscheidung ‚Ä¢ Timing</p>
                </div>
              </div>
              <span class="tag warn">Offen</span>
            </div>

            <div class="row">
              <div class="left">
                <div class="icon">üìà</div>
                <div>
                  <p class="rowTitle">Matchanalyse</p>
                  <p class="rowSub">Mini-Report ‚Ä¢ 3 KPIs ‚Ä¢ Hinweise</p>
                </div>
              </div>
              <span class="tag">Optional</span>
            </div>
          </div>

        </div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="section">
          <h2>Freie Slots</h2>
          <p class="muted" style="margin-top:-4px">Tippe auf <b>Jetzt buchen</b> ‚Üí kleines Fenster.</p>
          <div class="slotsGrid" id="slotsGrid"></div>
        </div>

        <div class="section" style="border-top:1px solid var(--line)">
          <h2>Schnell</h2>
          <div class="list">
            <div class="row">
              <div class="left">
                <div class="icon">ü™™</div>
                <div>
                  <p class="rowTitle">Profil</p>
                  <p class="rowSub">Einfach & klar f√ºr Kinder</p>
                </div>
              </div>
              <span class="tag ok">Aktiv</span>
            </div>

            <div class="row">
              <div class="left">
                <div class="icon">üîî</div>
                <div>
                  <p class="rowTitle">Benachrichtigungen</p>
                  <p class="rowSub">‚ÄûSlot best√§tigt‚Äú (sp√§ter)</p>
                </div>
              </div>
              <span class="tag">Coming</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modalWrap" id="modalWrap">
    <div class="modal">
      <div class="modalHead">
        <b id="modalTitle">Slot buchen</b>
        <button class="x" id="modalClose">‚úï</button>
      </div>
      <div class="modalBody">
        <p class="muted" id="modalInfo" style="margin:0 0 10px 0"></p>

        <div class="field">
          <label>Training</label>
          <select id="bookType">
            <option>Privattraining (Technik)</option>
            <option>Kognitives Training</option>
            <option>Athletik</option>
            <option>Matchanalyse</option>
          </select>
        </div>

        <div class="field">
          <label>Notiz (optional)</label>
          <input id="bookNote" placeholder="z.B. schwacher Fu√ü / erster Kontakt" />
        </div>
      </div>
      <div class="modalActions">
        <button class="btn" id="btnCancel">Abbrechen</button>
        <button class="btn primary" id="btnConfirm">Buchen</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===== Demo Data =====
    const member = {
      name: "Amine B.",
      meta: "U15 ‚Ä¢ Technik & Kognition",
      sportLevel: "Fortgeschritten",
      subStatus: "Aktiv",
      nextSession: "Mi 18:00",
      trainer: "Salem",
      status: "Aktiv" // Aktiv | Pause | Verletzung
    };
    const trainers = ["Salem", "G√ºni", "Tobi"];
    const slots = [
      { id: 1, day: "Di", time: "17:00", title: "Privattraining", desc: "Technik ‚Ä¢ Ballgef√ºhl", open: true },
      { id: 2, day: "Mi", time: "19:00", title: "Kognitives Training", desc: "Reaktion ‚Ä¢ Entscheidung", open: true },
      { id: 3, day: "Do", time: "18:30", title: "Athletik", desc: "Schnelligkeit ‚Ä¢ Stabilit√§t", open: false },
      { id: 4, day: "Sa", time: "10:30", title: "Matchanalyse", desc: "Mini-Report ‚Ä¢ KPIs", open: true }
    ];

    // ===== Stats (LocalStorage) =====
    const KEY = "sg_stats_v2";
    function todayKey(){ return new Date().toISOString().slice(0,10); }

    function loadStats(){
      const raw = localStorage.getItem(KEY);
      if(raw) return JSON.parse(raw);
      return {
        level: 42,
        history: [
          {date:"2025-12-17", present:true,  score:68},
          {date:"2025-12-18", present:true,  score:71},
          {date:"2025-12-19", present:false, score:0},
          {date:"2025-12-20", present:true,  score:73},
          {date:"2025-12-21", present:true,  score:75},
          {date:"2025-12-22", present:true,  score:77},
          {date:"2025-12-23", present:true,  score:78},
          {date:"2025-12-24", present:false, score:0},
          {date:"2025-12-25", present:true,  score:80},
          {date:"2025-12-26", present:true,  score:82},
        ]
      };
    }
    function saveStats(s){ localStorage.setItem(KEY, JSON.stringify(s)); }

    function calcAttendance(history){
      if(!history.length) return 0;
      const present = history.filter(x=>x.present).length;
      return Math.round((present / history.length) * 100);
    }
    function calcStreak(history){
      let streak = 0;
      for(let i=history.length-1; i>=0; i--){
        if(history[i].present) streak++;
        else break;
      }
      return streak;
    }
    function avgScore(history){
      const scored = history.filter(x=>x.present && x.score>0);
      if(!scored.length) return 0;
      const sum = scored.reduce((a,b)=>a+b.score,0);
      return Math.round(sum / scored.length);
    }

    // ===== UI helpers =====
    const $ = (id) => document.getElementById(id);

    function setStatusUI(status){
      $("statusLabel").textContent = status;
      const dot = $("statusDot");
      dot.style.background = status === "Aktiv" ? "var(--ok)" : (status === "Pause" ? "var(--warn)" : "var(--danger)");
      dot.style.boxShadow = status === "Aktiv"
        ? "0 0 0 5px rgba(37,208,127,.10)"
        : status === "Pause"
          ? "0 0 0 5px rgba(255,176,32,.10)"
          : "0 0 0 5px rgba(255,77,77,.10)";
    }

    function toast(msg){
      const el = $("toast");
      el.innerHTML = msg;
      el.style.display = "block";
      clearTimeout(window.__t);
      window.__t = setTimeout(()=> el.style.display="none", 2400);
    }

    // ===== Render Member =====
    function renderMember(){
      $("memberName").textContent = member.name;
      $("memberMeta").textContent = member.meta;
      $("sportLevel").textContent = member.sportLevel;
      $("subStatus").textContent = member.subStatus;
      $("nextSession").textContent = member.nextSession;
      $("trainerName").textContent = member.trainer;
      setStatusUI(member.status);
    }

    // ===== Render Slots =====
    function renderSlots(){
      const grid = $("slotsGrid");
      grid.innerHTML = "";

      slots.forEach(s => {
        const div = document.createElement("div");
        div.className = "slot";
        div.innerHTML = `
          <div>
            <strong>${s.day} ‚Ä¢ ${s.time} ‚Äî ${s.title}</strong>
            <small>${s.desc}</small>
          </div>
          <div class="right">
            <span class="tag ${s.open ? "warn" : ""}">${s.open ? "frei" : "belegt"}</span>
            <button class="slotBtn" ${s.open ? "" : "disabled"} data-id="${s.id}">Jetzt buchen</button>
          </div>
        `;
        grid.appendChild(div);
      });

      grid.querySelectorAll(".slotBtn").forEach(btn=>{
        btn.addEventListener("click", () => openBooking(parseInt(btn.dataset.id,10)));
      });
    }

    // ===== Modal / Booking =====
    let selectedSlot = null;
    function openBooking(slotId){
      selectedSlot = slots.find(s=>s.id===slotId);
      if(!selectedSlot) return;

      $("modalTitle").textContent = `Slot buchen: ${selectedSlot.day} ${selectedSlot.time}`;
      $("modalInfo").innerHTML = `
        <b>${selectedSlot.title}</b> ‚Äì ${selectedSlot.desc}<br/>
        Trainer: <b>${member.trainer}</b> ‚Ä¢ Status: <b>${member.status}</b>
      `;
      $("modalWrap").style.display = "flex";
    }
    function closeModal(){
      $("modalWrap").style.display = "none";
      $("bookNote").value = "";
      selectedSlot = null;
    }
    $("modalClose").addEventListener("click", closeModal);
    $("btnCancel").addEventListener("click", closeModal);
    $("btnConfirm").addEventListener("click", () => {
      if(!selectedSlot) return;
      const type = $("bookType").value;
      const note = $("bookNote").value.trim();

      selectedSlot.open = false;
      renderSlots();
      closeModal();
      toast(`‚úÖ <b>Buchung best√§tigt</b><br>${type} ‚Ä¢ ${selectedSlot.day} ${selectedSlot.time}${note ? " ‚Ä¢ Notiz: " + note : ""}`);
    });

    // ===== Stats: ring + chart =====
    function setRing(percent){
      const p = Math.max(0, Math.min(100, percent));
      const ring = $("ring");
      const ringVal = $("ringVal");
      ring.style.background = `conic-gradient(var(--accent) ${p*3.6}deg, rgba(255,255,255,.12) 0deg)`;
      ringVal.textContent = `${p}%`;
    }

    function drawChart(history){
      const canvas = $("miniChart");
      if(!canvas) return;
      const ctx = canvas.getContext("2d");
      const w = canvas.width, h = canvas.height;
      ctx.clearRect(0,0,w,h);

      // grid
      ctx.globalAlpha = 0.22;
      ctx.strokeStyle = "#ffffff";
      ctx.lineWidth = 1;
      for(let y=20; y<h; y+=40){
        ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke();
      }
      ctx.globalAlpha = 1;

      const last = history.slice(-10);
      const pad = 28;
      const chartW = w - pad*2;
      const chartH = h - pad*2;

      // axes
      ctx.globalAlpha = 0.28;
      ctx.beginPath();
      ctx.moveTo(pad, pad);
      ctx.lineTo(pad, pad+chartH);
      ctx.lineTo(pad+chartW, pad+chartH);
      ctx.stroke();
      ctx.globalAlpha = 1;

      const gap = 10;
      const barW = (chartW - gap*(last.length-1)) / last.length;

      last.forEach((d,i)=>{
        const x = pad + i*(barW+gap);
        const baseY = pad+chartH;

        // attendance bar
        const bh = d.present ? chartH*0.36 : chartH*0.10;
        ctx.globalAlpha = d.present ? 0.60 : 0.18;
        ctx.fillStyle = "#ff7a18";
        ctx.fillRect(x, baseY-bh, barW, bh);
        ctx.globalAlpha = 1;

        // score dot
        const score = d.present ? d.score : 0;
        const sy = pad + chartH - (score/100)*chartH;

        ctx.globalAlpha = d.present ? 0.90 : 0.25;
        ctx.beginPath();
        ctx.arc(x + barW/2, sy, 7, 0, Math.PI*2);
        ctx.fill();
        ctx.globalAlpha = 1;
      });
    }

    function renderStats(){
      const s = loadStats();
      const att = calcAttendance(s.history);
      const st = calcStreak(s.history);
      const perf = avgScore(s.history);
      const sessions = s.history.length;

      $("kpiSessions").textContent = sessions;
      $("kpiStreak").textContent = st;
      $("kpiPerf").textContent = perf;
      $("attendanceChip").textContent = `Anwesenheit: ${att}%`;

      const level = Math.max(0, Math.min(100, s.level ?? 0));
      setRing(level);

      drawChart(s.history);
    }

    function upsertToday(present){
      const s = loadStats();
      const t = todayKey();
      const score = present ? Math.floor(65 + Math.random()*25) : 0;

      const idx = s.history.findIndex(x=>x.date===t);
      if(idx >= 0) s.history[idx] = {date:t, present, score};
      else s.history.push({date:t, present, score});

      s.level = Math.max(0, Math.min(100, (s.level ?? 40) + (present ? 2 : -1)));

      saveStats(s);
      renderStats();
    }

    $("btnPresent").addEventListener("click", ()=> { upsertToday(true); toast("‚úÖ Training eingetragen: <b>anwesend</b>"); });
    $("btnAbsent").addEventListener("click", ()=> { upsertToday(false); toast("‚ùå Training eingetragen: <b>gefehlt</b>"); });
    $("btnResetStats").addEventListener("click", ()=>{
      localStorage.removeItem(KEY);
      renderStats();
      toast("Reset ‚úÖ");
    });

    // ===== Top buttons =====
    $("btnBook").addEventListener("click", () => {
      const firstOpen = slots.find(s=>s.open);
      if(!firstOpen){ toast("‚ö†Ô∏è Keine freien Slots."); return; }
      openBooking(firstOpen.id);
    });

    $("btnStatus").addEventListener("click", () => {
      const order = ["Aktiv","Pause","Verletzung"];
      const idx = order.indexOf(member.status);
      member.status = order[(idx+1) % order.length];
      renderMember();
      toast(`Status: <b>${member.status}</b>`);
    });

    $("btnSwapTrainer").addEventListener("click", () => {
      const idx = trainers.indexOf(member.trainer);
      member.trainer = trainers[(idx+1) % trainers.length];
      renderMember();
      toast(`Trainer: <b>${member.trainer}</b>`);
    });

    // init
    renderMember();
    renderSlots();
    renderStats();
  </script>
</body>
</html>
