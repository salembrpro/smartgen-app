<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SmartGen ‚Äì Spieler & Eltern Dashboard</title>

<style>
:root{
  --bg:#070a10;
  --text:#eaf2ff;
  --muted:#a7b6cf;
  --line:rgba(255,255,255,.12);

  --accent:#ff7a18;
  --accent2:#ffb14a;

  --ok:#25d07f;
  --warn:#ffb020;
  --danger:#ff4d4d;

  --radius:20px;
  --shadow: 0 26px 80px rgba(0,0,0,.55);
  --shadow2: 0 14px 36px rgba(0,0,0,.35);

  --cardA: rgba(16,24,36,.78);
  --cardB: rgba(10,14,22,.70);

  /* Parent Mode boost */
  --pGlow: 0 0 0 1px rgba(255,122,24,.26), 0 0 55px rgba(255,122,24,.18);
}

/* ============ BASE ============ */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  color:var(--text);
  background:#070a10;
  overflow-x:hidden;
}

/* ============ BACKGROUND (Carbon + Hex) ============ */
.bg{
  position:fixed; inset:0; z-index:-2;
  background:
    radial-gradient(900px 420px at 14% -10%, rgba(255,122,24,.14), transparent 62%),
    radial-gradient(900px 420px at 100% 10%, rgba(255,122,24,.08), transparent 64%),
    radial-gradient(900px 420px at 55% 115%, rgba(255,255,255,.06), transparent 60%),
    linear-gradient(180deg, #070a10 0%, #0b1323 55%, #070a10 100%);
}
.bg::before{
  content:"";
  position:absolute; inset:0;
  opacity:.55;
  background:
    linear-gradient(135deg, rgba(255,255,255,.05) 0 6px, rgba(0,0,0,0) 6px 12px),
    linear-gradient(315deg, rgba(255,255,255,.035) 0 6px, rgba(0,0,0,0) 6px 12px);
  background-size: 22px 22px;
  mix-blend-mode: overlay;
  filter: contrast(1.1);
}
.bg::after{
  content:"";
  position:absolute; inset:0;
  opacity:.12;
  background-image:
    radial-gradient(circle at 1px 1px, rgba(255,255,255,.25) 1px, transparent 1.2px),
    linear-gradient(60deg, rgba(255,255,255,.08) 1px, transparent 1px),
    linear-gradient(-60deg, rgba(255,255,255,.08) 1px, transparent 1px);
  background-size: 22px 22px, 44px 38px, 44px 38px;
  mix-blend-mode: screen;
}

/* ============ Parent Mode Overlay (more orange neon) ============ */
.parentFX{
  position:fixed; inset:0; z-index:-1;
  opacity:0; pointer-events:none;
  transition: opacity .25s ease;
  background:
    radial-gradient(900px 500px at 18% 0%, rgba(255,122,24,.22), transparent 62%),
    radial-gradient(900px 500px at 90% 20%, rgba(255,122,24,.14), transparent 62%),
    radial-gradient(900px 500px at 50% 120%, rgba(255,177,74,.10), transparent 65%);
  filter: blur(.2px);
}
body.parent .parentFX{ opacity:1; }

/* ============ LAYOUT ============ */
.wrap{max-width:1120px;margin:auto;padding:18px 14px 26px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:860px){.grid{grid-template-columns:1fr}}

.card{
  border:1px solid var(--line);
  border-radius: var(--radius);
  background: linear-gradient(180deg, var(--cardA), var(--cardB));
  box-shadow: var(--shadow);
  overflow:hidden;
}
.cardPad{padding:16px}
.hidden{display:none}

h2{margin:0 0 10px 0;font-size:18px;letter-spacing:.2px}
.small{color:var(--muted);font-size:13px;line-height:1.45}
.row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:9px 0}
.hr{border:none;border-top:1px solid var(--line); margin:12px 0}

/* ============ TOP ============ */
.top{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px;
  padding:14px 16px;
  border-bottom:1px solid var(--line);
  background:
    radial-gradient(700px 220px at 10% 0%, rgba(255,122,24,.20), transparent 60%),
    radial-gradient(700px 220px at 90% 10%, rgba(255,122,24,.10), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.04), transparent);
}
.brand{display:flex; align-items:center; gap:12px;}
.logoDot{
  width:44px; height:44px; border-radius:16px;
  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,.18), transparent 55%),
    linear-gradient(135deg, rgba(255,122,24,.95), rgba(255,177,74,.45));
  box-shadow: 0 0 0 1px rgba(255,255,255,.10), 0 18px 55px rgba(255,122,24,.18);
}
.brandTitle{font-weight:1000; letter-spacing:.2px}

.pills{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}
.pill{
  display:inline-flex; align-items:center; gap:10px;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid var(--line);
  background: rgba(0,0,0,.22);
  box-shadow: var(--shadow2);
  font-weight:1000;
  font-size:13px;
}
.dot{
  width:10px;height:10px;border-radius:50%;
  background: var(--ok);
  box-shadow: 0 0 0 5px rgba(37,208,127,.10);
}

/* ============ BUTTONS ============ */
.btn{
  padding:12px 14px;
  border-radius:16px;
  border:1px solid var(--line);
  background: rgba(0,0,0,.22);
  color: var(--text);
  font-weight:1000;
  cursor:pointer;
  font-size:14px;
}
.btn:active{transform:translateY(1px)}
.btn.primary{
  border-color: rgba(255,122,24,.75);
  background: linear-gradient(135deg, rgba(255,122,24,.22), rgba(255,255,255,.02));
  box-shadow: 0 18px 55px rgba(255,122,24,.12);
}
body.parent .btn.primary{ box-shadow: var(--pGlow); }
.btn.ok{
  border-color: rgba(37,208,127,.55);
  background: rgba(37,208,127,.12);
}
.btn.ghost{background: rgba(255,255,255,.06)}
.btn:disabled{opacity:.45; cursor:not-allowed}

/* ============ TAGS ============ */
.tag{
  padding:7px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:1000;
  background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.10);
  white-space:nowrap;
}
.tag.ok{background: rgba(37,208,127,.14); border-color: rgba(37,208,127,.35)}
.tag.warn{background: rgba(255,176,32,.14); border-color: rgba(255,176,32,.35)}
.tag.danger{background: rgba(255,77,77,.14); border-color: rgba(255,77,77,.35)}

/* ============ INPUTS ============ */
.input{
  padding:13px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.22);
  color: var(--text);
  width:100%;
  font-size:14px;
  outline:none;
}

/* ============ LIST / SLOTS ============ */
.list{display:flex;flex-direction:column;gap:10px;margin-top:10px}
.slot{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:12px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.18);
}
.slot strong{font-size:15px; font-weight:1000}
.slot small{display:block;color:var(--muted);margin-top:4px;font-size:13px}
.slot .right{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end}

/* ============ Coach / Video Demo ============ */
.coachGrid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:10px}
.coachCard{
  border:1px solid rgba(255,122,24,.25);
  background: linear-gradient(180deg, rgba(255,122,24,.10), rgba(0,0,0,.18));
  border-radius:18px;
  padding:14px;
}
body.parent .coachCard{ box-shadow: var(--pGlow); }
.coachTop{display:flex;align-items:center;justify-content:space-between;gap:10px}
.coachTitle{display:flex;align-items:center;gap:10px;font-weight:1000}
.coachTitle .ai{font-size:22px}
.videoDemo{
  margin-top:10px;
  border-radius:18px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.20);
  position:relative;
  height:170px;
}
/* fake "video" animation */
.videoDemo::before{
  content:"";
  position:absolute; inset:-30px;
  background:
    radial-gradient(120px 120px at 25% 30%, rgba(255,122,24,.25), transparent 60%),
    radial-gradient(160px 160px at 70% 55%, rgba(255,177,74,.12), transparent 62%),
    linear-gradient(135deg, rgba(255,255,255,.05), rgba(0,0,0,.25));
  transform: rotate(8deg);
  animation: floaty 5.2s ease-in-out infinite;
}
@keyframes floaty{
  0%,100%{transform:translateY(0) rotate(8deg)}
  50%{transform:translateY(-10px) rotate(8deg)}
}
.videoOverlay{
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  gap:10px;
  color:rgba(255,255,255,.92);
  font-weight:1000;
  text-shadow: 0 10px 30px rgba(0,0,0,.7);
}
.play{
  width:56px;height:56px;border-radius:20px;
  border:1px solid rgba(255,122,24,.55);
  background: rgba(255,122,24,.16);
  display:grid;place-items:center;
  box-shadow: var(--pGlow);
  font-size:22px;
}

/* ============ Wallet / NFC Card ============ */
.walletBtn{
  width:100%;
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:14px;
  border-radius:18px;
  border:1px solid rgba(255,122,24,.35);
  background: linear-gradient(135deg, rgba(255,122,24,.14), rgba(0,0,0,.20));
  cursor:pointer;
  font-weight:1000;
}
.walletBtn:hover{border-color: rgba(255,122,24,.55)}
.walletBtn .left{display:flex;align-items:center;gap:12px}
.walletBtn .ic{font-size:24px}
.walletBtn .right{opacity:.9}

/* ============ MODALS ============ */
.modalWrap{
  position:fixed; inset:0;
  background:rgba(0,0,0,.62);
  display:none;
  align-items:center; justify-content:center;
  padding:16px; z-index:50;
}
.modal{
  width:min(640px, 100%);
  background: linear-gradient(180deg, rgba(16,24,36,.94), rgba(10,14,22,.92));
  border:1px solid var(--line);
  border-radius:20px;
  overflow:hidden;
  box-shadow: 0 36px 120px rgba(0,0,0,.65);
}
.modalHead{
  padding:14px 16px;
  border-bottom:1px solid var(--line);
  display:flex; align-items:center; justify-content:space-between;
  background:
    radial-gradient(700px 220px at 15% 0%, rgba(255,122,24,.18), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.04), transparent);
}
.modalHead b{font-size:14px; letter-spacing:.2px}
.x{
  width:44px;height:44px;border-radius:16px;
  border:1px solid var(--line);
  background: rgba(0,0,0,.22);
  color:white;
  cursor:pointer;
  font-weight:1000;
}
.modalBody{padding:16px}
.modalActions{
  padding:14px 16px;
  border-top:1px solid var(--line);
  display:flex; gap:10px; justify-content:flex-end;
}

/* Wallet card inside modal */
.idCard{
  border-radius:22px;
  border:1px solid rgba(255,122,24,.40);
  background:
    radial-gradient(420px 240px at 20% 0%, rgba(255,122,24,.26), transparent 60%),
    radial-gradient(420px 240px at 90% 40%, rgba(255,177,74,.14), transparent 62%),
    linear-gradient(135deg, rgba(0,0,0,.25), rgba(255,255,255,.03));
  padding:16px;
  box-shadow: var(--pGlow);
}
.idTop{display:flex;align-items:center;justify-content:space-between;gap:10px}
.idName{font-weight:1000;font-size:16px}
.idSub{color:rgba(255,230,210,.85);font-weight:900;font-size:12px}
.idGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
  margin-top:12px;
}
.kv{
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.18);
  border-radius:14px;
  padding:10px;
}
.kv b{display:block;font-size:12px}
.kv span{color:rgba(255,255,255,.85);font-weight:900}
.qr{
  margin-top:12px;
  display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
}
.qrBox{
  width:120px;height:120px;border-radius:18px;
  border:1px solid rgba(255,255,255,.14);
  background:
    repeating-linear-gradient(0deg, rgba(255,255,255,.16) 0 6px, rgba(0,0,0,.0) 6px 12px),
    repeating-linear-gradient(90deg, rgba(255,255,255,.10) 0 6px, rgba(0,0,0,.0) 6px 12px);
  opacity:.9;
}
.nfcPill{
  display:inline-flex; align-items:center; gap:10px;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,122,24,.45);
  background: rgba(255,122,24,.12);
  font-weight:1000;
}

/* ============ TOAST ============ */
.toast{
  position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
  background: rgba(16,24,36,.94);
  border:1px solid var(--line);
  border-radius:18px;
  padding:12px 14px;
  display:none;
  z-index:60;
  font-size:13px;
  color:var(--muted);
  box-shadow: 0 18px 60px rgba(0,0,0,.55);
}
.toast b{color:var(--text)}
</style>
</head>

<body>
<div class="bg"></div>
<div class="parentFX"></div>

<div class="wrap">

  <!-- HEADER -->
  <div class="card">
    <div class="top">
      <div class="brand">
        <div class="logoDot"></div>
        <div>
          <div class="brandTitle">SmartGen Fussball Akademie</div>
          <div class="small" id="modeLabel">Modus: Spieler</div>
        </div>
      </div>

      <div class="pills">
        <div class="pill" title="Status">
          <span class="dot" id="statusDot"></span>
          <span id="statusText">Aktiv</span>
        </div>
        <button class="btn primary" onclick="setMode('player')">‚öΩ Spieler</button>
        <button class="btn" onclick="openPin()">üë®‚Äçüë©‚Äçüë¶ Eltern</button>
      </div>
    </div>

    <div class="cardPad">
      <div class="small">
        <b>Regel:</b> Eltern-Fitness ist <b>gesperrt</b>, wenn Kindertraining l√§uft. Freie Slots sind buchbar und werden gespeichert.
      </div>
    </div>
  </div>

  <div class="grid">

    <!-- LEFT COLUMN -->
    <div>

      <!-- PLAYER DASH -->
      <div id="playerDash" class="card">
        <div class="cardPad">
          <h2>‚öΩ Spieler Dashboard</h2>
          <div class="row"><b>Name</b><span>Amine B.</span></div>
          <div class="row"><b>Alter</b><span>13 Jahre</span></div>
          <div class="row"><b>Level</b><span>Fortgeschritten</span></div>
          <div class="row"><b>N√§chster Termin</b><span>Mi 18:00</span></div>
          <div class="row"><b>Status</b><span class="tag ok" id="playerStatusTag">Aktiv</span></div>
          <hr class="hr">
          <div class="small">Hinweis: Kinder-Trainingszeiten blockieren automatisch Eltern-Fitness.</div>
        </div>
      </div>

      <!-- PARENT DASH -->
      <div id="parentDash" class="hidden">

        <div class="card">
          <div class="cardPad">
            <h2>üë®‚Äçüë©‚Äçüë¶ Eltern Dashboard</h2>
            <div class="row"><b>Kind</b><span>Amine B.</span></div>
            <div class="row"><b>Vertrag</b><span class="tag ok">Aktiv (Premium)</span></div>
            <div class="row"><b>Laufzeit</b><span>01.02.2025 ‚Äì 31.01.2026</span></div>
            <div class="row"><b>Anwesenheit</b><span>84%</span></div>

            <hr class="hr">

            <button class="walletBtn" onclick="openWallet()">
              <div class="left">
                <span class="ic">üß°</span>
                <div>
                  <div style="font-weight:1000">SmartGen NFC / Wallet Karte</div>
                  <div class="small">Tap & Check-in ‚Ä¢ QR ‚Ä¢ Orange Edition</div>
                </div>
              </div>
              <div class="right">‚Ä∫</div>
            </button>

            <div class="small" style="margin-top:10px">
              Tipp: Das ist sp√§ter Apple Wallet / Google Wallet. Jetzt ist es als Demo in der App.
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardPad">
            <h2>üí¨ Kommunikation</h2>
            <div class="row"><b>Trainer</b><span>Salem</span></div>
            <input class="input" placeholder="Nachricht an Trainer schreiben‚Ä¶" />
            <button class="btn primary" style="margin-top:10px;width:100%">üì® Senden</button>
            <div class="small" style="margin-top:10px">
              (Demo) Sp√§ter: Chat-Verlauf + Schnellbuttons: ‚ÄûTermin verschieben‚Äú, ‚ÄûFrage‚Äú, ‚ÄûFeedback‚Äú.
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div>

      <!-- FITNESS -->
      <div id="fitnessCard" class="card hidden">
        <div class="cardPad">
          <h2>üèãÔ∏è Eltern-Fitness buchen</h2>

          <div class="row" style="margin-top:12px">
            <div><b>Heute</b> <span class="small" id="todayLabel"></span></div>
            <button class="btn ghost" onclick="resetBookings()">Reset (Demo)</button>
          </div>

          <div class="list" id="fitnessSlots"></div>

          <hr class="hr">
          <div class="small"><b>Gebucht:</b> <span id="bookCount">0</span> Slot(s) ‚Ä¢ Du kannst auch stornieren.</div>

          <hr class="hr">
          <h2>üß† KI Fitness Coach (Eltern)</h2>

          <div class="coachGrid" id="coachGrid"></div>

          <div class="small" style="margin-top:10px">
            Idee: Sp√§ter echte Videos + personalisierte Pl√§ne (R√ºcken, Cardio, Kraft) je nach Ziel.
          </div>
        </div>
      </div>

      <!-- NOT OPENED YET -->
      <div id="parentHint" class="card">
        <div class="cardPad">
          <h2>üë®‚Äçüë©‚Äçüë¶ Eltern Bereich</h2>
          <div class="small">
            Klicke oben auf <b>Eltern</b> und gib den PIN ein. Dann erscheint hier die Fitness-Buchung + KI Coach.
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- PIN MODAL -->
<div id="pinModal" class="modalWrap">
  <div class="modal">
    <div class="modalHead">
      <b>üîê Eltern-Freigabe (PIN)</b>
      <button class="x" onclick="closePin()">‚úï</button>
    </div>
    <div class="modalBody">
      <div class="small">Demo-PIN: <b>1234</b> (sp√§ter individuell pro Elternkonto)</div>
      <div style="margin-top:10px">
        <input id="pinInput" class="input" placeholder="PIN eingeben">
      </div>
    </div>
    <div class="modalActions">
      <button class="btn" onclick="closePin()">Abbrechen</button>
      <button class="btn primary" onclick="checkPin()">Freigeben</button>
    </div>
  </div>
</div>

<!-- BOOK MODAL -->
<div id="bookModal" class="modalWrap">
  <div class="modal">
    <div class="modalHead">
      <b id="bookTitle">Slot buchen</b>
      <button class="x" onclick="closeBook()">‚úï</button>
    </div>
    <div class="modalBody">
      <div class="small" id="bookInfo"></div>

      <div style="margin-top:12px">
        <label class="small"><b>Trainingstyp</b></label>
        <select id="bookType" class="input" style="margin-top:6px">
          <option>Eltern Fitness ‚Äì Kraft</option>
          <option>Eltern Fitness ‚Äì Cardio</option>
          <option>Mobility / R√ºcken</option>
          <option>Regeneration / Stretching</option>
        </select>
      </div>

      <div style="margin-top:12px">
        <label class="small"><b>Notiz (optional)</b></label>
        <input id="bookNote" class="input" style="margin-top:6px" placeholder="z.B. Fokus: R√ºcken / Kondition">
      </div>
    </div>
    <div class="modalActions">
      <button class="btn" onclick="closeBook()">Abbrechen</button>
      <button class="btn ok" onclick="confirmBooking()">‚úÖ Buchen</button>
    </div>
  </div>
</div>

<!-- WALLET MODAL -->
<div id="walletModal" class="modalWrap">
  <div class="modal">
    <div class="modalHead">
      <b>üß° SmartGen NFC / Wallet Karte</b>
      <button class="x" onclick="closeWallet()">‚úï</button>
    </div>
    <div class="modalBody">
      <div class="idCard">
        <div class="idTop">
          <div>
            <div class="idName">Eltern-ID ‚Ä¢ SmartGen</div>
            <div class="idSub">Orange NFC Edition ‚Ä¢ Demo</div>
          </div>
          <div class="nfcPill">üì∂ NFC aktiv</div>
        </div>

        <div class="idGrid">
          <div class="kv"><b>Elternteil</b><span>Parent One</span></div>
          <div class="kv"><b>Kind</b><span>Amine B.</span></div>
          <div class="kv"><b>Vertrag</b><span>Premium</span></div>
          <div class="kv"><b>Status</b><span>Aktiv</span></div>
        </div>

        <div class="qr">
          <div class="qrBox" title="QR Demo"></div>
          <div style="flex:1;min-width:200px">
            <div style="font-weight:1000">Check-in / Zugang</div>
            <div class="small">QR scannen oder NFC tap am Eingang (Demo Logik).</div>
            <button class="btn primary" style="margin-top:10px" onclick="simulateNFC()">üì∂ NFC Tap simulieren</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modalActions">
      <button class="btn" onclick="closeWallet()">Schlie√üen</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* =========================
   CONFIG
========================= */
const PARENT_PIN = "1234";

// Kinder-Training blockiert Eltern-Fitness
const kidTrainings = [
  { day: 3, start: "18:00", end: "19:30", label: "Kindertraining (Mi 18:00‚Äì19:30)" },
  { day: 5, start: "17:30", end: "19:00", label: "Kindertraining (Fr 17:30‚Äì19:00)" },
  { day: 6, start: "10:00", end: "11:30", label: "Kindertraining (Sa 10:00‚Äì11:30)" },
];

// Eltern-Fitness (wiederkehrend)
const fitnessSlotsCatalog = [
  { id:"mon_0900", day:1, start:"09:00", end:"10:00", title:"Eltern Fitness", desc:"Kraft ‚Ä¢ Core" },
  { id:"mon_1100", day:1, start:"11:00", end:"12:00", title:"Eltern Fitness", desc:"Cardio ‚Ä¢ Intervall" },
  { id:"tue_0930", day:2, start:"09:30", end:"10:30", title:"Mobility", desc:"Beweglichkeit ‚Ä¢ R√ºcken" },
  { id:"wed_1700", day:3, start:"17:00", end:"18:00", title:"Eltern Fitness", desc:"Kraft ‚Ä¢ Basics" },
  { id:"wed_1830", day:3, start:"18:30", end:"19:30", title:"Eltern Fitness", desc:"Cardio ‚Ä¢ HIIT" },
  { id:"fri_0900", day:5, start:"09:00", end:"10:00", title:"Regeneration", desc:"Stretch ‚Ä¢ Atmung" },
  { id:"fri_1800", day:5, start:"18:00", end:"19:00", title:"Eltern Fitness", desc:"Kraft ‚Ä¢ Mix" },
  { id:"sat_1830", day:6, start:"18:30", end:"19:30", title:"Eltern Fitness", desc:"Abend Slot" },
];

const KEY_BOOK = "sg_parent_bookings_v1";

/* KI Coach Demo (Texte + ‚ÄúMini-Video‚Äù Placeholder) */
const COACH = [
  {
    title:"R√ºcken & Core (10 Min)",
    steps:[
      "1) Cat-Cow (45s)",
      "2) Plank (3√ó20s)",
      "3) Glute Bridge (3√ó10)",
      "4) Stretch (2 Min)"
    ],
    tip:"Perfekt nach der Arbeit. Fokus: R√ºcken entlasten."
  },
  {
    title:"Cardio Quick (12 Min)",
    steps:[
      "1) Warm-up (2 Min)",
      "2) 6√ó (30s schnell / 30s locker)",
      "3) Cooldown (2 Min)"
    ],
    tip:"Wenn du wenig Zeit hast ‚Äì aber schnell Energie willst."
  },
  {
    title:"Mobility Beine (8 Min)",
    steps:[
      "1) H√ºft√∂ffner (60s)",
      "2) Kniebeugen langsam (2√ó8)",
      "3) Wadenmobilit√§t (60s)",
      "4) Dehnen (2 Min)"
    ],
    tip:"Sehr gut, wenn du viel sitzt oder Schmerzen in den Knien hast."
  }
];

/* =========================
   STATE / HELPERS
========================= */
let mode = "player";
let selectedSlotId = null;

function $(id){ return document.getElementById(id); }

function toast(msg){
  const t = $("toast");
  t.innerHTML = msg;
  t.style.display = "block";
  clearTimeout(window.__to);
  window.__to = setTimeout(()=> t.style.display="none", 2700);
}

function dayName(d){ return ["So","Mo","Di","Mi","Do","Fr","Sa"][d]; }
function now(){ return new Date(); }
function toMin(hhmm){ const [h,m]=hhmm.split(":").map(Number); return h*60+m; }
function overlaps(aStart,aEnd,bStart,bEnd){ return Math.max(aStart,bStart) < Math.min(aEnd,bEnd); }

function isBlockedByKidTraining(slot){
  const sA = toMin(slot.start), sB = toMin(slot.end);
  const blocks = kidTrainings.filter(k=>k.day === slot.day);
  for(const k of blocks){
    const kA = toMin(k.start), kB = toMin(k.end);
    if(overlaps(sA,sB,kA,kB)) return {blocked:true, reason:k.label};
  }
  return {blocked:false, reason:""};
}

/* =========================
   MODE / STATUS UI
========================= */
function setStatusUI(text){
  $("statusText").textContent = text;
  const dot = $("statusDot");
  dot.style.background = (text==="Aktiv") ? "var(--ok)" : (text==="Pause") ? "var(--warn)" : "var(--danger)";
  dot.style.boxShadow = (text==="Aktiv")
    ? "0 0 0 5px rgba(37,208,127,.10)"
    : (text==="Pause")
      ? "0 0 0 5px rgba(255,176,32,.10)"
      : "0 0 0 5px rgba(255,77,77,.10)";
}

function setMode(next){
  mode = next;
  document.body.classList.toggle("parent", mode==="parent");
  $("modeLabel").textContent = "Modus: " + (mode==="parent" ? "Eltern (Orange Neon)" : "Spieler");

  $("playerDash").classList.toggle("hidden", mode !== "player");
  $("parentDash").classList.toggle("hidden", mode !== "parent");
  $("fitnessCard").classList.toggle("hidden", mode !== "parent");
  $("parentHint").classList.toggle("hidden", mode === "parent");

  if(mode === "parent"){
    renderFitness();
    renderCoach();
    setStatusUI("Aktiv");
  }else{
    setStatusUI("Aktiv");
  }
}

/* =========================
   PIN
========================= */
function openPin(){
  $("pinModal").style.display = "flex";
  $("pinInput").value = "";
  $("pinInput").focus();
}
function closePin(){ $("pinModal").style.display = "none"; }
function checkPin(){
  const pin = $("pinInput").value.trim();
  if(pin === PARENT_PIN){
    closePin();
    setMode("parent");
    toast("‚úÖ <b>Eltern-Freigabe aktiv</b><br>Orange Neon + KI Coach + Wallet ist verf√ºgbar.");
  } else {
    toast("‚ùå <b>Falscher PIN</b><br>Bitte erneut versuchen.");
  }
}

/* =========================
   BOOKINGS
========================= */
function loadBookings(){
  const raw = localStorage.getItem(KEY_BOOK);
  return raw ? JSON.parse(raw) : [];
}
function saveBookings(list){
  localStorage.setItem(KEY_BOOK, JSON.stringify(list));
}
function isBooked(slotId){
  return loadBookings().some(b => b.slotId === slotId);
}
function resetBookings(){
  localStorage.removeItem(KEY_BOOK);
  renderFitness();
  toast("üßπ <b>Reset</b><br>Alle Demo-Buchungen gel√∂scht.");
}

/* =========================
   FITNESS UI
========================= */
function renderFitness(){
  const d = now();
  $("todayLabel").textContent = `(${dayName(d.getDay())} ‚Ä¢ ${d.toLocaleDateString()})`;

  const list = $("fitnessSlots");
  list.innerHTML = "";

  const bookings = loadBookings();
  $("bookCount").textContent = bookings.length;

  const sorted = [...fitnessSlotsCatalog].sort((a,b)=>{
    if(a.day !== b.day) return a.day - b.day;
    return toMin(a.start) - toMin(b.start);
  });

  for(const slot of sorted){
    const blockInfo = isBlockedByKidTraining(slot);
    const booked = isBooked(slot.id);

    const div = document.createElement("div");
    div.className = "slot";

    const statusTag = blockInfo.blocked
      ? `<span class="tag danger">Gesperrt</span>`
      : booked
        ? `<span class="tag ok">Gebucht</span>`
        : `<span class="tag warn">Frei</span>`;

    const actionBtn = blockInfo.blocked
      ? `<button class="btn" disabled>‚õî Nicht m√∂glich</button>`
      : booked
        ? `<button class="btn ghost" onclick="cancelBooking('${slot.id}')">Stornieren</button>`
        : `<button class="btn ok" onclick="openBook('${slot.id}')">Buchen</button>`;

    div.innerHTML = `
      <div>
        <strong>${dayName(slot.day)} ‚Ä¢ ${slot.start}‚Äì${slot.end} ‚Äî ${slot.title}</strong>
        <small>${slot.desc}${blockInfo.blocked ? " ‚Ä¢ <b>Block:</b> "+blockInfo.reason : ""}</small>
      </div>
      <div class="right">
        ${statusTag}
        ${actionBtn}
      </div>
    `;

    list.appendChild(div);
  }
}

/* =========================
   COACH UI
========================= */
function renderCoach(){
  const grid = $("coachGrid");
  grid.innerHTML = "";

  COACH.forEach((c,idx)=>{
    const card = document.createElement("div");
    card.className = "coachCard";
    card.innerHTML = `
      <div class="coachTop">
        <div class="coachTitle"><span class="ai">ü§ñ</span> <span>${c.title}</span></div>
        <button class="btn primary" onclick="useCoach(${idx})">Plan starten</button>
      </div>

      <div class="videoDemo" title="Mini Video Demo (Placeholder)">
        <div class="videoOverlay">
          <div class="play">‚ñ∂</div>
          <div>
            <div style="font-weight:1000">Mini-Video Demo</div>
            <div class="small">So trainierst du (Demo)</div>
          </div>
        </div>
      </div>

      <div class="small" style="margin-top:10px">
        <b>√úbungen:</b><br>
        ${c.steps.map(s=>`‚Ä¢ ${s}`).join("<br>")}
        <div style="margin-top:8px"><b>Tipp:</b> ${c.tip}</div>
      </div>
    `;
    grid.appendChild(card);
  });
}

function useCoach(i){
  const c = COACH[i];
  toast(`ü§ñ <b>KI Coach aktiviert</b><br>${c.title}<br><span class="small">Plan: ${c.steps[0]}</span>`);
}

/* =========================
   BOOK MODAL
========================= */
function openBook(slotId){
  const slot = fitnessSlotsCatalog.find(s=>s.id===slotId);
  if(!slot) return;

  const blockInfo = isBlockedByKidTraining(slot);
  if(blockInfo.blocked){
    toast("‚õî <b>Gesperrt</b><br>Dieser Slot kollidiert mit Kindertraining.");
    return;
  }
  if(isBooked(slotId)){
    toast("‚úÖ <b>Schon gebucht</b><br>Du kannst ihn stornieren.");
    return;
  }

  selectedSlotId = slotId;
  $("bookTitle").textContent = `Slot buchen: ${dayName(slot.day)} ${slot.start}‚Äì${slot.end}`;
  $("bookInfo").innerHTML = `<b>${slot.title}</b> ‚Äì ${slot.desc}<br>Regel: keine Buchung w√§hrend Kindertraining.`;
  $("bookType").value = "Eltern Fitness ‚Äì Kraft";
  $("bookNote").value = "";
  $("bookModal").style.display = "flex";
}
function closeBook(){
  $("bookModal").style.display = "none";
  selectedSlotId = null;
}
function confirmBooking(){
  if(!selectedSlotId) return;

  const slot = fitnessSlotsCatalog.find(s=>s.id===selectedSlotId);
  if(!slot) return;

  const type = $("bookType").value;
  const note = $("bookNote").value.trim();

  const bookings = loadBookings();
  bookings.push({ slotId:selectedSlotId, createdAt:new Date().toISOString(), type, note });
  saveBookings(bookings);

  closeBook();
  renderFitness();
  toast(`‚úÖ <b>Buchung best√§tigt</b><br>${dayName(slot.day)} ${slot.start}‚Äì${slot.end} ‚Ä¢ ${type}${note? "<br><span class='small'>Notiz: "+note+"</span>":""}`);
}
function cancelBooking(slotId){
  const slot = fitnessSlotsCatalog.find(s=>s.id===slotId);
  const bookings = loadBookings().filter(b => b.slotId !== slotId);
  saveBookings(bookings);
  renderFitness();
  toast(`üóëÔ∏è <b>Storniert</b><br>${slot ? (dayName(slot.day)+" "+slot.start+"‚Äì"+slot.end) : "Slot"} wurde entfernt.`);
}

/* =========================
   WALLET / NFC DEMO
========================= */
function openWallet(){ $("walletModal").style.display="flex"; }
function closeWallet(){ $("walletModal").style.display="none"; }
function simulateNFC(){
  toast("üì∂ <b>NFC Tap OK</b><br>Zugang/Check-in registriert (Demo).");
}

/* init */
setStatusUI("Aktiv");
setMode("player");
</script>
</body>
</html>
